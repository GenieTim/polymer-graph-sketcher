var Ye=Object.defineProperty;var xe=o=>{throw TypeError(o)};var $e=(o,e,t)=>e in o?Ye(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var a=(o,e,t)=>$e(o,typeof e!="symbol"?e+"":e,t),be=(o,e,t)=>e.has(o)||xe("Cannot "+t);var se=(o,e,t)=>(be(o,e,"read from private field"),t?t.call(o):e.get(o)),Ne=(o,e,t)=>e.has(o)?xe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),ye=(o,e,t,s)=>(be(o,e,"write to private field"),s?s.call(o,t):e.set(o,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class p{constructor(e,t){a(this,"x");a(this,"y");this.x=e,this.y=t}}class b extends p{constructor(e,t){e instanceof p?(super(e.x,e.y),this.x=e.x,this.y=e.y):(super(e,t),this.x=e,this.y=t)}add(e){return new b(this.x+e.x,this.y+e.y)}subtract(e){return new b(this.x-e.x,this.y-e.y)}multiply(e){return new b(this.x*e,this.y*e)}toString(){return`(${this.x}, ${this.y})`}}var P;const A=class A{constructor(e=new p(825,445),t="#FFFFFF",s=10){a(this,"isScaled",!1);a(this,"canvasSize");a(this,"backgroundColor");a(this,"imageScaleFactor");a(this,"disablePBC",!1);this.canvasSize=e,this.backgroundColor=t,this.imageScaleFactor=s}static get instance(){return se(A,P)||ye(A,P,new A),se(A,P)}static fromJSON(e){return ye(A,P,new A(new p(e.canvasSize.x,e.canvasSize.y),e.backgroundColor,e.imageScaleFactor)),"disablePBC"in e&&(se(A,P).disablePBC=e.disablePBC),se(A,P)}};P=new WeakMap,Ne(A,P);let x=A;class ze{constructor(e=null,t=1,s=1,n="#000",i="#000"){a(this,"center");a(this,"radius");a(this,"strokeWidth");a(this,"fillColor");a(this,"strokeColor");this.center=e||new p(0,0),this.radius=t,this.strokeWidth=s,this.fillColor=n,this.strokeColor=i}setCenter(e){this.center=e}setRadius(e){this.radius=e}draw(e){e.beginPath(),e.arc(this.center.x,this.center.y,this.radius,0,2*Math.PI),this.fillColor&&(e.fillStyle=this.fillColor,e.fill()),e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeWidth,e.stroke()}}class re{constructor(e,t,s=!1,n="#000",i=2,r=6,d=4,c=2){a(this,"from");a(this,"to");a(this,"dashed");a(this,"zigZagged");a(this,"color");a(this,"lineWidth");a(this,"zigzagSpacing");a(this,"oneZigZagLength");a(this,"straightLengthWhenZigZag");a(this,"lineRadians");a(this,"lineLength");this.from=e,this.to=t,this.dashed=!1,this.zigZagged=s,this.color=n,this.lineWidth=i,this.zigzagSpacing=r,this.oneZigZagLength=d,this.straightLengthWhenZigZag=c,this.lineRadians=Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x);const h=this.from.x-this.to.x,u=this.from.y-this.to.y;this.lineLength=Math.sqrt(h*h+u*u)}setFrom(e){this.from=e}setTo(e){this.to=e}getFrom(){return this.from}getTo(){return this.to}draw(e){const t=x.instance;var s=this.to.x-this.from.x,n=this.to.y-this.from.y;const i=Math.abs(n)>.5001*t.canvasSize.y,r=Math.abs(s)>.5001*t.canvasSize.x;if((i||r)&&!t.disablePBC){[new re(new p(this.from.x,this.from.y),new p(this.to.x+t.canvasSize.x*(r?s<0?1:-1:0),this.to.y+t.canvasSize.y*(i?n<0?1:-1:0)),this.zigZagged,this.color,this.lineWidth,this.zigzagSpacing,this.oneZigZagLength,this.straightLengthWhenZigZag),new re(new p(this.to.x,this.to.y),new p(this.from.x+t.canvasSize.x*(r?s<0?-1:1:0),this.from.y+t.canvasSize.y*(i?n<0?-1:1:0)),this.zigZagged,this.color,this.lineWidth,this.zigzagSpacing,this.oneZigZagLength,this.straightLengthWhenZigZag)].forEach(d=>d.draw(e));return}this.dashed&&e.setLineDash([4,2]),e.lineCap="round",e.lineWidth=this.lineWidth,e.strokeStyle=this.color,this.zigZagged?this.drawZigZagged(e):(e.beginPath(),e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y)),e.stroke()}drawZigZagged(e){e.save(),e.beginPath(),e.translate(this.from.x,this.from.y),e.rotate(this.lineRadians),e.moveTo(0,0),e.lineTo(this.straightLengthWhenZigZag,0);let t=this.straightLengthWhenZigZag;for(let s=0;t<this.lineLength-this.straightLengthWhenZigZag;s++){t=(s+1)*this.zigzagSpacing;const n=s%2==0?-this.oneZigZagLength:this.oneZigZagLength;e.lineTo(t,n)}e.lineTo(this.lineLength-this.straightLengthWhenZigZag,0),e.lineTo(this.lineLength,0),e.restore()}setDashed(e){this.dashed=e}setZigZagged(e){this.zigZagged=e}}class me extends re{constructor(t,s,n=1,i=!1,r="#000",d=2,c=6,h=4,u=2){super(t,s,i,r,d,c,h,u);a(this,"progress");this.progress=Math.max(0,Math.min(1,n))}setProgress(t){this.progress=Math.max(0,Math.min(1,t))}draw(t){if(this.progress===0)return;if(this.progress===1){super.draw(t);return}const s=x.instance;var n=this.to.x-this.from.x,i=this.to.y-this.from.y;const r=Math.abs(i)>.5001*s.canvasSize.y,d=Math.abs(n)>.5001*s.canvasSize.x;if((r||d)&&!s.disablePBC){[new me(new p(this.from.x,this.from.y),new p(this.to.x+s.canvasSize.x*(d?n<0?1:-1:0),this.to.y+s.canvasSize.y*(r?i<0?1:-1:0)),this.progress,this.zigZagged,this.color,this.lineWidth,this.zigzagSpacing,this.oneZigZagLength,this.straightLengthWhenZigZag),new me(new p(this.to.x,this.to.y),new p(this.from.x+s.canvasSize.x*(d?n<0?-1:1:0),this.from.y+s.canvasSize.y*(r?i<0?-1:1:0)),this.progress,this.zigZagged,this.color,this.lineWidth,this.zigzagSpacing,this.oneZigZagLength,this.straightLengthWhenZigZag)].forEach(h=>h.draw(t));return}const c=new p(this.from.x+(this.to.x-this.from.x)*this.progress,this.from.y+(this.to.y-this.from.y)*this.progress);this.dashed&&t.setLineDash([4,2]),t.lineCap="round",t.lineWidth=this.lineWidth,t.strokeStyle=this.color,this.zigZagged?this.drawPartialZigZagged(t,c):(t.beginPath(),t.moveTo(this.from.x,this.from.y),t.lineTo(c.x,c.y),t.stroke())}drawPartialZigZagged(t,s){const n=this.lineLength*this.progress;if(t.save(),t.beginPath(),t.translate(this.from.x,this.from.y),t.rotate(this.lineRadians),t.moveTo(0,0),n<=this.straightLengthWhenZigZag)t.lineTo(n,0);else if(n>=this.lineLength-this.straightLengthWhenZigZag){t.lineTo(this.straightLengthWhenZigZag,0);let i=this.straightLengthWhenZigZag;for(let r=0;i<this.lineLength-this.straightLengthWhenZigZag;r++){i=(r+1)*this.zigzagSpacing;const d=r%2==0?-this.oneZigZagLength:this.oneZigZagLength;t.lineTo(i,d)}t.lineTo(this.lineLength-this.straightLengthWhenZigZag,0),t.lineTo(n,0)}else{t.lineTo(this.straightLengthWhenZigZag,0);let i=this.straightLengthWhenZigZag;for(let r=0;i<n;r++){if(i=(r+1)*this.zigzagSpacing,i>=n){const c=r*this.zigzagSpacing,h=(r-1)%2==0?-this.oneZigZagLength:this.oneZigZagLength,u=r%2==0?-this.oneZigZagLength:this.oneZigZagLength,N=(n-c)/this.zigzagSpacing,v=h+(u-h)*N;t.lineTo(n,v);break}const d=r%2==0?-this.oneZigZagLength:this.oneZigZagLength;t.lineTo(i,d)}}t.stroke(),t.restore()}}class ve{constructor(e=null,t=100,s=100,n=2,i="#000",r=null){a(this,"topLeft");a(this,"width");a(this,"height");a(this,"strokeColor");a(this,"lineWidth");a(this,"fillColor");this.topLeft=e||new p(0,0),this.width=t,this.height=s,this.strokeColor=i,this.lineWidth=n,this.fillColor=r}draw(e){e.beginPath(),e.rect(this.topLeft.x,this.topLeft.y,this.width,this.height),this.fillColor?e.fillStyle=this.fillColor:e.fillStyle="transparent",e.fill(),e.lineWidth=this.lineWidth,this.strokeColor&&(e.strokeStyle=this.strokeColor,e.stroke())}}class y{constructor(e,t,s=5,n=1,i="#000",r="#000"){a(this,"id");a(this,"coordinates");a(this,"radius");a(this,"strokeWidth");a(this,"fillColor");a(this,"strokeColor");if(typeof e!="number"||!Number.isInteger(e)||e<0)throw new Error("Invalid `id` parameter. It must be a non-negative integer, got `"+e+"`.");this.id=e,this.coordinates=t,this.radius=s,this.strokeWidth=n,this.fillColor=i,this.strokeColor=r}}class we{constructor(e,t,s,n=1,i="#000"){a(this,"fromId");a(this,"toId");a(this,"weight");a(this,"color");a(this,"id");this.fromId=e,this.toId=t,this.id=s,this.weight=n,this.color=i}getOtherNodeId(e){return this.fromId===e?this.toId:this.fromId}}class Ve{constructor(){a(this,"nodes");a(this,"edges");a(this,"scalingFactor");a(this,"zigzagSpacing",4);a(this,"zigzagLength",3);a(this,"zigzagEndLengths",1.5);a(this,"maxNodeId",0);this.nodes={},this.edges=[],this.scalingFactor=new p(1,1)}clear(){this.nodes={},this.edges=[]}setNode(e){this.nodes[e.id]=e,this.maxNodeId=Math.max(this.maxNodeId,e.id)}addEdge(e,t,s="#000",n=1){if(!(e in this.nodes)||!(t in this.nodes))throw new Error("One or both nodes do not exist in the graph.");return this.edges.push(new we(e,t,this.edges.length,n,s)),this.edges.length-1}getNode(e){if(!(e in this.nodes))throw new Error(`Node with id "${e}" does not exist.`);return this.nodes[e]}getNrOfNodes(){return Object.keys(this.nodes).length}getNrOfEdges(){return this.edges.length}getAllNodeIds(){return Object.values(this.nodes).map(e=>e.id)}getNextNodeId(){return this.maxNodeId+1}getAllNodes(){return Object.values(this.nodes)}getAllEdges(){return this.edges}getNodesConnectedToNode(e){return this.getEdgesInvolvingNode(e).map(t=>this.nodes[t.fromId===e?t.toId:t.fromId])}deepConnectedTo(e){const t=new Set,s=[],n=[e.id];for(;n.length>0;){const i=n.shift();if(t.has(i))continue;t.add(i),s.push(this.getNode(i));const r=this.getEdgesInvolvingNode(i).map(d=>d.getOtherNodeId(i)).filter(d=>!t.has(d));n.push(...r)}return s}getEdgesInvolvingNode(e){return this.edges.filter(t=>t.fromId===e||t.toId===e)}getEdgesInvolvingNodes(e){return this.edges.filter(t=>e.includes(t.fromId)&&e.includes(t.toId))}cleanupEdges(){this.edges=this.edges.filter(e=>e.fromId!==e.toId)}removeDuplicateEdges(){const e=new Set;this.edges=this.edges.filter(t=>{const s=`${Math.min(t.fromId,t.toId)}-${Math.max(t.fromId,t.toId)}`;return e.has(s)?!1:(e.add(s),!0)})}getEdgesWithBothEndsInNodes(e){return this.edges.filter(t=>e.includes(t.fromId)&&e.includes(t.toId))}fromJSON(e){this.nodes={},this.edges=[];for(const[,t]of Object.entries(e.nodes))this.setNode(new y(t.id,t.coordinates,t.radius,t.strokeWidth,t.fillColor,t.strokeColor));for(const t of e.edges)this.addEdge(t.fromId,t.toId,t.color,t.weight);"scalingFactor"in e&&(this.scalingFactor=new p(e.scalingFactor.x,e.scalingFactor.y)),"zigzagSpacing"in e&&(this.zigzagSpacing=e.zigzagSpacing),"zigzagLength"in e&&(this.zigzagLength=e.zigzagLength),this.cleanupEdges()}toDrawables(){const e=[],t=Math.max(this.scalingFactor.x,this.scalingFactor.y);for(const s of this.edges){const n=this.getNode(s.fromId),i=this.getNode(s.toId);if(n&&i){const r=new p(n.coordinates.x*this.scalingFactor.x,n.coordinates.y*this.scalingFactor.y),d=new p(i.coordinates.x*this.scalingFactor.x,i.coordinates.y*this.scalingFactor.y);e.push(new re(r,d,!0,s.color,s.weight*t,this.zigzagSpacing*t,this.zigzagLength*t,this.zigzagEndLengths*t))}else throw new Error(`Node with id ${s.fromId} or ${s.toId} does not exist in the graph.`)}for(const s of Object.values(this.nodes)){const n=new p(s.coordinates.x*this.scalingFactor.x,s.coordinates.y*this.scalingFactor.y);e.push(new ze(n,s.radius*t,s.strokeWidth*t,s.fillColor,s.strokeColor))}return e}findNodesByCoordinates(e,t){let s=[];for(const[,n]of Object.entries(this.nodes))Math.sqrt(Math.pow(n.coordinates.x-e,2)+Math.pow(n.coordinates.y-t,2))<=5&&s.push(n);return s}findNodeByCoordinates(e,t){const s=this.findNodesByCoordinates(e,t);return s.length>0?s[0]:null}deleteNode(e){if(!this.getNode(e))throw new Error("The node does not exist in the graph.");delete this.nodes[e];for(let s=0;s<this.edges.length;s++)(this.edges[s].fromId===e||this.edges[s].toId===e)&&(this.edges.splice(s,1),s--)}deleteEdge(e){if(e instanceof we&&(e=this.edges.indexOf(e)),e<0||e>=this.edges.length)throw new Error("Invalid edge ID "+e+". Edge ID must be between 0 and "+(this.edges.length-1)+".");const t=this.edges[e];return this.edges.splice(e,1),t}}const l=new Ve;class Ge{constructor(){a(this,"selectedItems",[])}toggleItems(e){e.forEach(t=>{this.hasItem(t)?this.removeItem(t):this.addItem(t)})}addItem(e){this.selectedItems.push(e)}setItem(e){this.selectedItems=[e]}hasItem(e){return this.selectedItems.includes(e)}hasItems(e){return e.every(t=>this.hasItem(t))}setSelectedItems(e){this.selectedItems=e}removeItem(e){this.selectedItems=this.selectedItems.filter(t=>t!==e)}removeLastItem(){this.selectedItems.length>0&&this.selectedItems.pop()}getSelectedItems(){return this.selectedItems}getItemsOfClass(e){return this.selectedItems.filter(t=>t instanceof e)}clearSelection(){this.selectedItems=[]}get empty(){return this.selectedItems.length===0}get length(){return this.selectedItems.length}}const g=new Ge;class Ue{constructor(e){a(this,"doneStack",[]);a(this,"undoneStack",[]);a(this,"afterActionCallback");this.afterActionCallback=e}addAction(e){this.doneStack.push(e),e.do(),this.undoneStack=[],this.afterActionCallback()}undo(){if(this.doneStack.length){const e=this.doneStack.pop();e.undo(),this.undoneStack.push(e),this.afterActionCallback()}}redo(){if(this.undoneStack.length){const e=this.undoneStack.pop();e.do(),this.doneStack.push(e),this.afterActionCallback()}}}class ue{constructor(e,t,s){a(this,"affectedNodes");a(this,"originalValues");a(this,"targetValue");a(this,"property");this.affectedNodes=e,this.originalValues=e.map(n=>n[s]),this.targetValue=t,this.property=s}do(){this.affectedNodes.forEach(e=>{e[this.property]=this.targetValue})}undo(){this.affectedNodes.forEach((e,t)=>{e[this.property]=this.originalValues[t]})}}class He{constructor(e){this.nodes=e}do(){this.nodes.forEach(e=>{l.setNode(new y(e.id,e.coordinates,e.radius,e.strokeWidth,e.fillColor,e.strokeColor))}),g.setSelectedItems(this.nodes.map(e=>l.getNode(e.id)))}undo(){this.nodes.forEach(e=>{l.deleteNode(e.id)})}}class Me{constructor(e,t){this.nodeId=e,this.position=t}do(){l.setNode(new y(this.nodeId,this.position,parseFloat(document.getElementById("vertexRadius").value),parseFloat(document.getElementById("vertexStrokeWidth").value),document.getElementById("nodeFillColor").value,document.getElementById("nodeColor").value)),g.setItem(l.getNode(this.nodeId))}undo(){l.deleteNode(this.nodeId)}}class ke{constructor(e){a(this,"affectedEdges",[]);this.affectedNodes=e}do(){this.affectedNodes.forEach(e=>{l.getEdgesInvolvingNode(e.id).forEach(t=>{this.affectedEdges.push(t)}),g.removeItem(e),l.deleteNode(e.id)})}undo(){this.affectedNodes.forEach(e=>{l.setNode(e),g.addItem(e)}),this.affectedEdges.forEach(e=>{l.addEdge(e.fromId,e.toId,e.color,e.weight)})}}class ie{constructor(e,t=!1){a(this,"previousSelectedNodes",g.getSelectedItems());this.affectedNodes=e,this.clearSelection=t}do(){this.clearSelection?g.setSelectedItems(this.affectedNodes):this.affectedNodes.forEach(e=>{g.addItem(e)})}undo(){g.setSelectedItems(this.previousSelectedNodes)}}class Je{constructor(e){a(this,"previousSelectedNodes",g.getSelectedItems());this.affectedNodes=e,this.affectedNodes.forEach(t=>{this.previousSelectedNodes.includes(t)||console.warn("Trying to unselect a node that is not selected")}),console.log("Unselecting nodes:",this.affectedNodes)}do(){g.setSelectedItems(this.previousSelectedNodes.filter(e=>!(e instanceof y&&this.affectedNodes.includes(e))))}undo(){g.setSelectedItems(this.previousSelectedNodes)}}class je{constructor(e=g.getItemsOfClass(y)){this.previousSelectedNodes=e}do(){g.setSelectedItems(l.getAllNodes())}undo(){g.setSelectedItems(this.previousSelectedNodes)}}class Ke{constructor(e=g.getSelectedItems()){this.previousSelectedNodes=e}do(){g.clearSelection()}undo(){g.setSelectedItems(this.previousSelectedNodes)}}class Qe{constructor(e=g.getSelectedItems()){this.previousSelectedNodes=e}do(){g.toggleItems(l.getAllNodes())}undo(){g.setSelectedItems(this.previousSelectedNodes)}}class et{constructor(e,t){a(this,"edgeIds",[]);if(this.edgesFrom=e,this.edgesTo=t,e.length!==t.length)throw new Error("edgesFrom and edgesTo must have the same length")}do(){for(let e=0;e<this.edgesFrom.length;e++)this.edgeIds.push(l.addEdge(this.edgesFrom[e],this.edgesTo[e],document.getElementById("edgeColor").value,parseFloat(document.getElementById("lineWidth").value)))}undo(){this.edgeIds.slice().reverse().forEach(e=>{l.deleteEdge(e)})}}class Ae{constructor(e,t){a(this,"edgeIds",[]);this.fromNode=e,this.affectedNodes=t}do(){this.affectedNodes.forEach(e=>{this.edgeIds.push(l.addEdge(this.fromNode.id,e.id,document.getElementById("edgeColor").value,parseFloat(document.getElementById("lineWidth").value)))}),this.affectedNodes.length<=1&&g.setItem(this.fromNode)}undo(){this.edgeIds.slice().reverse().forEach(e=>{l.deleteEdge(e)}),g.setSelectedItems(this.affectedNodes)}}class tt{constructor(e,t){a(this,"edges",[]);this.additionalNode=t,t&&e.push(t),this.edges=l.getEdgesInvolvingNodes(e.map(s=>s.id))}do(){this.edges.forEach(e=>{l.deleteEdge(e)}),this.additionalNode&&g.addItem(this.additionalNode)}undo(){this.edges.forEach(e=>{l.addEdge(e.fromId,e.toId,e.color,e.weight)}),this.additionalNode&&g.removeItem(this.additionalNode)}}class st{constructor(e,t){a(this,"svg");a(this,"lastElement");a(this,"currentGroup",null);a(this,"prevState",null);a(this,"currentXOffset",0);a(this,"currentYOffset",0);a(this,"currentRotationRad",0);a(this,"currentX",0);a(this,"currentY",0);a(this,"canvas");a(this,"globalAlpha",1);a(this,"globalCompositeOperation");a(this,"fillStyle");a(this,"strokeStyle");a(this,"filter");a(this,"imageSmoothingEnabled");a(this,"imageSmoothingQuality");a(this,"lineCap","butt");a(this,"lineDashOffset");a(this,"lineJoin","round");a(this,"lineWidth",0);a(this,"miterLimit");a(this,"shadowBlur");a(this,"shadowColor");a(this,"shadowOffsetX");a(this,"shadowOffsetY");a(this,"direction","ltr");a(this,"font");a(this,"fontKerning");a(this,"fontStretch","normal");a(this,"fontVariantCaps","normal");a(this,"letterSpacing");a(this,"textAlign","left");a(this,"textBaseline");a(this,"textRendering");a(this,"wordSpacing");this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",e.toString()),this.svg.setAttribute("height",t.toString()),this.lastElement=this.svg}addElement(e){this.currentGroup?this.currentGroup.appendChild(e):this.svg.appendChild(e),this.lastElement=e}pointIsOnCanvas(e){const t={width:parseFloat(this.svg.getAttribute("width")),height:parseFloat(this.svg.getAttribute("height"))};return e.x>=0&&e.x<=t.width&&e.y>=0&&e.y<=t.height}rect(e,t,s,n){const i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x",e.toString()),i.setAttribute("y",t.toString()),i.setAttribute("width",s.toString()),i.setAttribute("height",n.toString()),this.addElement(i)}clearRect(e,t,s,n){this.rect(e,t,s,n),this.lastElement.setAttribute("style","background-color: white; fill: white;")}fillRect(e,t,s,n){this.rect(e,t,s,n),this.lastElement.setAttribute("style",this.stylesToCSS(!0,!1)+";stroke:none;")}strokeRect(e,t,s,n){this.rect(e,t,s,n),this.lastElement.setAttribute("style",this.stylesToCSS(!1,!0)+";fill:none;")}arc(e,t,s,n,i){const r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",e.toString()),r.setAttribute("cy",t.toString()),r.setAttribute("r",s.toString()),r.setAttribute("style",this.stylesToCSS(!0,!0)),this.addElement(r)}moveTo(e,t){this.currentX=e,this.currentY=t}rotate(e){this.currentRotationRad+=e}translate(e,t){this.currentXOffset+=e,this.currentYOffset+=t}lineTo(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","line"),n=Math.cos(this.currentRotationRad)*this.currentX-Math.sin(this.currentRotationRad)*this.currentY,i=Math.sin(this.currentRotationRad)*this.currentX+Math.cos(this.currentRotationRad)*this.currentY,r=Math.cos(this.currentRotationRad)*e-Math.sin(this.currentRotationRad)*t,d=Math.sin(this.currentRotationRad)*e+Math.cos(this.currentRotationRad)*t,c=new p(n+this.currentXOffset,i+this.currentYOffset),h=new p(r+this.currentXOffset,d+this.currentYOffset);s.setAttribute("x1",c.x.toString()),s.setAttribute("y1",c.y.toString()),s.setAttribute("x2",h.x.toString()),s.setAttribute("y2",h.y.toString()),s.setAttribute("style",this.stylesToCSS(!1,!0)),this.lineCap&&s.setAttribute("stroke-linecap",this.lineCap),(this.pointIsOnCanvas(c)||this.pointIsOnCanvas(h)||c.x<=0&&h.x>=parseFloat(this.svg.getAttribute("width"))||c.y<=0&&h.y>=parseFloat(this.svg.getAttribute("height")))&&this.addElement(s),this.currentX=e,this.currentY=t}stroke(){this.addStyles(this.stylesToCSS(!1,!0))}fill(e,t){if(e||t)throw new Error("Method not implemented.");this.addStyles(this.stylesToCSS(!0,!1))}addStyles(e){if(this.lastElement){const t=this.lastElement.getAttribute("style"),s=this.parseStyles(e);if(t){const n=this.parseStyles(t);for(const[i,r]of Object.entries(n))s[i]||(s[i]=r)}this.lastElement.setAttribute("style",this.styleMapToString(s));for(const[n,i]of Object.entries(s))this.lastElement.setAttribute(n,i)}}parseStyles(e){const t={};return e.split(";").forEach(n=>{const[i,r]=n.trim().split(":");t[i.trim()]=r.trim()}),t}styleMapToString(e){return Object.entries(e).map(([t,s])=>`${t}: ${s}`).join("; ")}restore(){if(this.prevState)this.fillStyle=this.prevState.fillStyle,this.strokeStyle=this.prevState.strokeStyle,this.lineWidth=this.prevState.lineWidth,this.currentX=this.prevState.currentX,this.currentY=this.prevState.currentY,this.lastElement=this.prevState.lastElement,this.currentXOffset=this.prevState.currentXOffset,this.currentYOffset=this.prevState.currentYOffset,this.currentRotationRad=this.prevState.currentRotationRad,this.prevState=null,this.currentGroup=null;else throw new Error("No state to restore.")}save(){if(this.prevState)throw new Error("Only one state can be saved at a time.");this.prevState={fillStyle:this.fillStyle,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth,currentX:this.currentX,currentY:this.currentY,lastElement:this.lastElement,currentXOffset:this.currentXOffset,currentYOffset:this.currentYOffset,currentRotationRad:this.currentRotationRad};const e=document.createElementNS("http://www.w3.org/2000/svg","g");this.svg.appendChild(e),this.lastElement=e,this.currentGroup=e}stylesToCSS(e=!0,t=!0){let s={"stroke-width":this.lineWidth.toString(),"stroke-linecap":this.lineCap||"butt"};return e&&this.fillStyle&&(s.fill=this.fillStyle.toString()),t&&this.strokeStyle&&(s.stroke=this.strokeStyle.toString()),this.styleMapToString(s)}getSVG(){return this.svg}beginPath(){}closePath(){}getContextAttributes(){throw new Error("Method not implemented.")}drawImage(e,t,s,n,i,r,d,c,h){throw new Error("Method not implemented.")}clip(e,t){throw new Error("Method not implemented.")}isPointInPath(e,t,s,n){throw new Error("Method not implemented.")}isPointInStroke(e,t,s){throw new Error("Method not implemented.")}createConicGradient(e,t,s){throw new Error("Method not implemented.")}createLinearGradient(e,t,s,n){throw new Error("Method not implemented.")}createPattern(e,t){throw new Error("Method not implemented.")}createRadialGradient(e,t,s,n,i,r){throw new Error("Method not implemented.")}createImageData(e,t,s){throw new Error("Method not implemented.")}getImageData(e,t,s,n,i){throw new Error("Method not implemented.")}putImageData(e,t,s,n,i,r,d){throw new Error("Method not implemented.")}arcTo(e,t,s,n,i){throw new Error("Method not implemented.")}scale(e,t){throw new Error("Method not implemented.")}bezierCurveTo(e,t,s,n,i,r){throw new Error("Method not implemented.")}ellipse(e,t,s,n,i,r,d,c){throw new Error("Method not implemented.")}quadraticCurveTo(e,t,s,n){throw new Error("Method not implemented.")}roundRect(e,t,s,n,i){throw new Error("Method not implemented.")}getLineDash(){throw new Error("Method not implemented.")}setLineDash(e){throw new Error("Method not implemented.")}isContextLost(){throw new Error("Method not implemented.")}reset(){throw new Error("Method not implemented.")}fillText(e,t,s,n){throw new Error("Method not implemented.")}measureText(e){throw new Error("Method not implemented.")}strokeText(e,t,s,n){throw new Error("Method not implemented.")}getTransform(){throw new Error("Method not implemented.")}resetTransform(){throw new Error("Method not implemented.")}setTransform(e,t,s,n,i,r){throw new Error("Method not implemented.")}transform(e,t,s,n,i,r){throw new Error("Method not implemented.")}drawFocusIfNeeded(e,t){throw new Error("Method not implemented.")}}function Be(o,e){for(;o.x>e.x;)o.x-=e.x*2;for(;o.x<-e.x;)o.x+=e.x*2;for(;o.y>e.y;)o.y-=e.y*2;for(;o.y<-e.y;)o.y+=e.y*2;return o}function Le(o,e){for(;o.x<0;)o.x+=e.x;for(;o.x>e.x;)o.x-=e.x;for(;o.y<0;)o.y+=e.y;for(;o.y>e.y;)o.y-=e.y;return o}function it(o,e){const t=new b(o.coordinates.x,o.coordinates.y);return new b(e.coordinates.x,e.coordinates.y).subtract(t)}function Re(){const o=new b(x.instance.canvasSize.y,x.instance.canvasSize.x),e=o.multiply(.5);console.log("Box size: "+o.toString(),[e,o]),g.getItemsOfClass(y).forEach(s=>{const n=l.getNodesConnectedToNode(s.id);let i=new b(0,0);n.forEach(d=>{const c=it(s,d),h=Be(c,e).multiply(1/n.length);i=i.add(h)}),console.log(`Node ${s.id} has force: ${i.toString()}`);const r=Le(new b(i.x+s.coordinates.x,i.y+s.coordinates.y),o);s.coordinates.x=r.x,s.coordinates.y=r.y})}function nt(o){const e=new b(x.instance.canvasSize.x,x.instance.canvasSize.y),t=document.getElementById("randomWalkStepSize").valueAsNumber,s=document.getElementById("randomWalkMaxAngle").valueAsNumber*Math.PI/180,n=document.getElementById("randomWalkSteps").valueAsNumber,i=[],r=[],d=document.getElementById("vertexRadius").valueAsNumber,c=document.getElementById("vertexStrokeWidth").valueAsNumber,h=document.getElementById("nodeFillColor").value,u=document.getElementById("nodeColor").value,N=new y(l.getNextNodeId(),o,d,c,h,u);i.push(N);let v=new p(o.x,o.y),E=Math.random()*2*Math.PI;const Z=document.getElementById("edgeColor").value,G=parseFloat(document.getElementById("lineWidth").value);for(let z=0;z<n;z++){const M=(Math.random()*2-1)*s;E+=M;const _=v.x+t*Math.cos(E),q=v.y+t*Math.sin(E);v=new p(_,q),v=Le(v,e);const B=new y(l.getNextNodeId()+z+1,v,d,c,h,u);i.push(B);const k=i[i.length-2],T=new we(k.id,B.id,-1,G,Z);r.push(T)}return{nodes:i,edges:r}}function Fe(){const o=g.getItemsOfClass(y);if(console.log("Equilibrating "+o.length+" nodes..."),o.length<1)return;const t=new b(x.instance.canvasSize.x,x.instance.canvasSize.y).multiply(.5),s=25;for(const n of o){let i=new b(0,0);for(const d of l.getAllNodes()){if(n.id===d.id)continue;const c=new b(n.coordinates.x,n.coordinates.y);let u=new b(d.coordinates.x,d.coordinates.y).subtract(c);u=Be(u,t);const N=Math.sqrt(u.x*u.x+u.y*u.y);if(N>0){const v=s/(N*N),E=u.multiply(-v);i=i.add(E)}}console.log(`Node ${n.id} experiences force: ${i.toString()} and has radius ${n.radius}...`),i.x>n.radius&&(i.x=n.radius),i.x<-n.radius&&(i.x=-n.radius),i.y>n.radius&&(i.y=n.radius),i.y<-n.radius&&(i.y=-n.radius);const r=new b(n.coordinates.x+i.x,n.coordinates.y+i.y);n.coordinates=r}}function Pe(o,e){if(o===e)return;if(o>e)return Pe(e,o);l.getEdgesInvolvingNode(e).forEach(i=>{i.fromId===e?i.fromId=o:i.toId=o});const s=l.getNode(o),n=l.getNode(e);s.coordinates.x=(s.coordinates.x+n.coordinates.x)/2,s.coordinates.y=(s.coordinates.y+n.coordinates.y)/2,l.deleteNode(e)}function ot(o){let e;do{e=!1;for(const t of l.getAllEdges())if(t.color===o){Pe(t.fromId,t.toId),l.deleteEdge(t),e=!0;break}}while(e);g.clearSelection()}function rt(){const o=l.getAllNodes();for(const e of o){const t=l.getEdgesInvolvingNode(e.id);t.length===2&&t[0].color===t[1].color&&t[0].weight===t[1].weight&&(l.deleteEdge(t[0]),l.deleteEdge(t[1]),l.addEdge(t[0].fromId==e.id?t[0].toId:t[0].fromId,t[1].fromId==e.id?t[1].toId:t[1].fromId,t[0].color,t[0].weight),l.deleteNode(e.id))}}const S=class S{static hex2lab(e){const[t,s,n]=S.hex2rgba(e);return S.rgba2lab(t,s,n,1)}static rgba2lab(e,t,s,n){const[i,r,d]=S.rgb2xyz(e,t,s);return S.xyz2lab(i,r,d)}static lab2rgba(e,t,s){const[n,i,r]=S.lab2xyz(e,t,s);return[...S.xyz2rgba(n,i,r),1]}static hex2rgba(e){const t=e.replace(/^#/,"").toUpperCase();if(!/^[0-9A-F]+$/i.test(t)||![3,4,6,8].includes(t.length))throw new Error(`Invalid HEX format: ${e}`);let n=t;[3,4].includes(t.length)&&(n=t.split("").map(u=>u+u).join(""));const i=parseInt(n,16);let r,d,c,h=1;return n.length===8?(h=(i&255)/255,r=i>>16&255,d=i>>8&255,c=i&255):(r=i>>16&255,d=i>>8&255,c=i&255),[Math.min(255,Math.max(0,r)),Math.min(255,Math.max(0,d)),Math.min(255,Math.max(0,c)),Math.min(1,Math.max(0,h))]}static rgb2xyz(e,t,s){const n=c=>c>.04045?Math.pow((c+.055)/1.055,2.4):c/12.92,[i,r,d]=[e/255,t/255,s/255].map(c=>n(c)*100);return[i*.4124564+r*.3575761+d*.1804375,i*.2126729+r*.7151522+d*.072175,i*.0193339+r*.119192+d*.9503041]}static xyz2rgba(e,t,s){const n=h=>(h=h>.0031308?1.055*Math.pow(h,.4166666666666667)-.055:12.92*h,Math.round(Math.min(255,Math.max(0,h*255)))),i=[e/100,t/100,s/100],r=i[0]*3.2404542+i[1]*-1.5371385+i[2]*-.4985314,d=i[0]*-.969266+i[1]*1.8760108+i[2]*.041556,c=i[0]*.0556434+i[1]*-.2040259+i[2]*1.0572252;return[n(r),n(d),n(c)]}static xyz2lab(e,t,s){const n=c=>c>.008856?Math.pow(c,.3333333333333333):7.787*c+.13793103448275862,i=n(e/S.REF_X),r=n(t/S.REF_Y),d=n(s/S.REF_Z);return[116*r-16,500*(i-r),200*(r-d)]}static lab2xyz(e,t,s){const n=(e+16)/116,i=t/500+n,r=n-s/200,d=c=>c>.2068966?Math.pow(c,3):(c-16/116)/7.787;return[d(i)*S.REF_X,d(n)*S.REF_Y,d(r)*S.REF_Z]}static deltaE00(e,t){const[s,n,i]=e,[r,d,c]=t,h=pe=>pe*180/Math.PI,u=pe=>pe*Math.PI/180,N=1,v=1,E=1,Z=Math.sqrt(n**2+i**2),G=Math.sqrt(d**2+c**2),z=(Z+G)/2,M=.5*(1-Math.sqrt(z**7/(z**7+25**7))),_=n*(1+M),q=d*(1+M),B=Math.sqrt(_**2+i**2),k=Math.sqrt(q**2+c**2),T=i===0&&_===0?0:h(Math.atan2(i,_))%360,U=c===0&&q===0?0:h(Math.atan2(c,q))%360,de=r-s,ce=k-B;let L=0;B*k!==0&&(L=U-T,L>180?L-=360:L<-180&&(L+=360));const Q=2*Math.sqrt(B*k)*Math.sin(u(L)/2),ee=(s+r)/2,H=(B+k)/2;let O=(T+U)/2;Math.abs(T-U)>180&&(O+=180);const le=1-.17*Math.cos(u(O-30))+.24*Math.cos(u(2*O))+.32*Math.cos(u(3*O+6))-.2*Math.cos(u(4*O-63)),he=1+.015*(ee-50)**2/Math.sqrt(20+(ee-50)**2),te=1+.045*H,ge=1+.015*H*le,qe=30*Math.exp((-((O-275)/25))**2),Xe=-(2*Math.sqrt(H**7/(H**7+25**7)))*Math.sin(u(2*qe));return Math.sqrt((de/(N*he))**2+(ce/(v*te))**2+(Q/(E*ge))**2+Xe*(ce/(v*te))*(Q/(E*ge)))}static adjustLightness(e,t,s,n,i){const[r,d,c]=S.rgba2lab(e,t,s,n),h=Math.min(100,Math.max(0,r+r*i));return[...S.lab2rgba(h,d,c)]}};a(S,"REF_X",95.047),a(S,"REF_Y",100),a(S,"REF_Z",108.883);let ne=S;class at{constructor(e={}){a(this,"sequences",[]);a(this,"currentSequenceIndex",0);a(this,"currentFrameIndex",0);a(this,"isPlaying",!1);a(this,"isPaused",!1);a(this,"animationFrameId",null);a(this,"lastFrameTime",0);a(this,"options");a(this,"animate",()=>{if(!this.isPlaying||this.isPaused)return;if(this.currentSequenceIndex>=this.sequences.length){this.stop();return}const e=this.sequences[this.currentSequenceIndex],t=e.frames[this.currentFrameIndex];if(!t){e.onComplete&&e.onComplete(),this.currentSequenceIndex++,this.currentFrameIndex=0,this.lastFrameTime=performance.now(),this.animationFrameId=requestAnimationFrame(this.animate);return}const s=performance.now(),n=t.duration||e.defaultFrameDuration||16;s-this.lastFrameTime>=n&&(t.action(),e.onFrame&&e.onFrame(this.currentFrameIndex,e.frames.length),this.currentFrameIndex++,this.lastFrameTime=s),this.animationFrameId=requestAnimationFrame(this.animate)});this.options={targetFPS:e.targetFPS||60,autoPlay:e.autoPlay!==void 0?e.autoPlay:!0}}addSequence(e){e.defaultFrameDuration||(e.defaultFrameDuration=1e3/this.options.targetFPS),this.sequences.push(e),this.options.autoPlay&&!this.isPlaying&&this.play()}clearSequences(){this.stop(),this.sequences=[],this.currentSequenceIndex=0,this.currentFrameIndex=0}play(){this.isPlaying&&!this.isPaused||(this.isPlaying=!0,this.isPaused=!1,this.lastFrameTime=performance.now(),this.animate())}pause(){this.isPaused=!0,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}resume(){this.isPaused&&(this.isPaused=!1,this.lastFrameTime=performance.now(),this.animate())}stop(){this.isPlaying=!1,this.isPaused=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.currentSequenceIndex=0,this.currentFrameIndex=0}getIsPlaying(){return this.isPlaying&&!this.isPaused}getIsPaused(){return this.isPaused}getProgress(){const e=this.sequences[this.currentSequenceIndex];return{sequence:this.currentSequenceIndex,frame:this.currentFrameIndex,total:(e==null?void 0:e.frames.length)||0}}}class Ee{static fromActions(e,t,s=100,n){return{name:e,frames:t.map(i=>({action:i})),defaultFrameDuration:s,onComplete:n}}static repeat(e,t,s,n=100,i){return{name:e,frames:Array(s).fill(null).map(()=>({action:t})),defaultFrameDuration:n,onComplete:i}}static withTiming(e,t,s){return{name:e,frames:t,onComplete:s}}static interpolate(e,t,s,n=1e3,i){const r=n/t,d=[];for(let c=0;c<=t;c++){const h=c/t;d.push({action:()=>s(h),duration:r})}return{name:e,frames:d,onComplete:i}}}class dt{constructor(e,t={}){a(this,"mediaRecorder",null);a(this,"recordedChunks",[]);a(this,"stream",null);a(this,"isRecording",!1);a(this,"canvas");a(this,"options");this.canvas=e,this.options={fps:t.fps||60,videoBitsPerSecond:t.videoBitsPerSecond||25e5,mimeType:t.mimeType||"video/webm;codecs=vp9"}}start(){if(this.isRecording){console.warn("Recording already in progress");return}this.recordedChunks=[],this.stream=this.canvas.captureStream(this.options.fps);let e=this.options.mimeType;MediaRecorder.isTypeSupported(e)||(console.warn(`${e} not supported, trying vp8`),e="video/webm;codecs=vp8",MediaRecorder.isTypeSupported(e)||(console.warn(`${e} not supported, using default`),e="video/webm")),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:e,videoBitsPerSecond:this.options.videoBitsPerSecond}),this.mediaRecorder.ondataavailable=t=>{t.data&&t.data.size>0&&this.recordedChunks.push(t.data)},this.mediaRecorder.start(),this.isRecording=!0,console.log("Recording started")}stop(){return new Promise((e,t)=>{if(!this.isRecording||!this.mediaRecorder){t(new Error("No recording in progress"));return}this.mediaRecorder.onstop=()=>{const s=new Blob(this.recordedChunks,{type:"video/webm"});this.isRecording=!1,this.stream&&this.stream.getTracks().forEach(n=>n.stop()),console.log("Recording stopped, blob size:",s.size),e(s)},this.mediaRecorder.stop()})}getIsRecording(){return this.isRecording}async download(e="polymer-graph-animation.webm"){if(this.isRecording){const t=await this.stop();this.downloadBlob(t,e)}else if(this.recordedChunks.length>0){const t=new Blob(this.recordedChunks,{type:"video/webm"});this.downloadBlob(t,e)}else throw new Error("No recording available to download")}downloadBlob(e,t){const s=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=s,n.download=t,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),URL.revokeObjectURL(s)},500)}}class ct{constructor(e){a(this,"recorder");a(this,"animator");a(this,"isRecordingMovie",!1);var t;this.recorder=new dt(e.canvas,e.recorderOptions),this.animator=new at({targetFPS:((t=e.animatorOptions)==null?void 0:t.targetFPS)||60,autoPlay:!1})}async startRecording(){if(this.isRecordingMovie)throw new Error("Already recording a movie");this.isRecordingMovie=!0,this.recorder.start()}async stopAndDownload(e){if(!this.isRecordingMovie)throw new Error("Not currently recording");this.animator.getIsPlaying()&&this.animator.stop(),await this.recorder.download(e),this.isRecordingMovie=!1}addSequence(e){this.animator.addSequence(e)}clearSequences(){this.animator.clearSequences()}play(){this.animator.play()}pause(){this.animator.pause()}resume(){this.animator.resume()}stop(){this.animator.stop()}async recordMovie(e,t){return new Promise((s,n)=>{this.clearSequences(),e.forEach(i=>this.addSequence(i)),this.addSequence({name:"completion",frames:[{action:()=>{setTimeout(async()=>{try{await this.stopAndDownload(t),s()}catch(i){n(i)}},500)}}],defaultFrameDuration:100}),this.startRecording().then(()=>{this.play()}).catch(n)})}getIsRecording(){return this.isRecordingMovie}getIsPlaying(){return this.animator.getIsPlaying()}getProgress(){return this.animator.getProgress()}static get AnimationBuilder(){return Ee}}class lt{static createSimulationAnimation(e,t,s={}){const{stepDuration:n=300,stepCount:i=10}=s,r=[];for(let d=0;d<i;d++)r.push({action:()=>{e(),t()},duration:n});return{name:"Simulation Animation",frames:r,defaultFrameDuration:n}}static createNodeAdditionAnimation(e,t,s=200){return Ee.fromActions("Node Addition Animation",e.map(n=>()=>{n(),t()}),s)}static createCombinedAnimation(e,t){return e.map(s=>Ee.fromActions(s.name,s.actions.map(n=>()=>{n(),t()}),s.frameDuration||200))}}var I=document.getElementById("canvas"),J=document.getElementById("canvas-parent"),$=I.getContext("2d"),X=[],R="vertex",oe=0,m=x.instance,Se=!0,V=null,f=new Ue(()=>w()),ae=null,C=[],D=!1,Y=[];function Ze(){$.clearRect(0,0,I.width,I.height),X.forEach(function(o){o.draw($)}),Y.forEach(function(o){o&&o.draw($)})}I.addEventListener("click",function(o){if(!V){var e=o.clientX-I.offsetLeft+window.scrollX,t=o.clientY-I.offsetTop+window.scrollY;if(R==="vertex")f.addAction(new Me(oe,new p(e,t))),oe+=1;else if(R==="edge"){var s=l.findNodeByCoordinates(e,t);if(s!==null)if(g.empty)f.addAction(new ie([s]));else{if(D){const i=document.getElementById("edgeColor").value,r=parseFloat(document.getElementById("lineWidth").value);g.getItemsOfClass(y).forEach(d=>{C.push({type:"add",fromNode:d,toNode:s,color:i,weight:r})}),K()}f.addAction(new Ae(s,g.getItemsOfClass(y)))}}else if(R==="delete_vertex"){var s=l.findNodeByCoordinates(e,t);s!==null&&f.addAction(new ke([s]))}else if(R==="delete_edge"){var s=l.findNodeByCoordinates(e,t);s!==null&&!g.empty||g.length>1?(D&&s!==null&&!g.empty&&(l.getEdgesInvolvingNodes([...g.getItemsOfClass(y).map(d=>d.id),s.id]).forEach(d=>{const c=l.getNode(d.fromId),h=l.getNode(d.toId);C.push({type:"remove",fromNode:c,toNode:h,color:d.color,weight:d.weight})}),K()),f.addAction(new tt(g.getItemsOfClass(y),s))):s&&f.addAction(new ie([s]))}else if(R==="select"){var n=l.findNodesByCoordinates(e,t);n.length&&(g.hasItems(n)?(console.log("Unselecting node"),f.addAction(new Je(n))):(console.log("Selecting node"),f.addAction(new ie(n))))}else if(R==="select_chains"){const i=l.findNodeByCoordinates(e,t);if(i!==null){const r=l.deepConnectedTo(i);f.addAction(new ie(r,!0))}}else if(R==="random_walk"){const i=nt(new p(e,t));f.addAction(new He(i.nodes)),f.addAction(new et(i.edges.map(r=>r.fromId),i.edges.map(r=>r.toId))),oe+=i.nodes.length+1}}});window.addEventListener("mousedown",function(o){V={x:o.clientX,y:o.clientY}});window.addEventListener("mousemove",function(o){if(V){const e=o.clientX-V.x,t=o.clientY-V.y;g.getItemsOfClass(y).forEach(s=>{s.coordinates.x+=e,s.coordinates.y+=t,s.coordinates.x<0&&(s.coordinates.x+=x.instance.canvasSize.x),s.coordinates.x>=x.instance.canvasSize.x&&(s.coordinates.x-=x.instance.canvasSize.x),s.coordinates.y<0&&(s.coordinates.y+=x.instance.canvasSize.y),s.coordinates.y>=x.instance.canvasSize.y&&(s.coordinates.y-=x.instance.canvasSize.y)}),V={x:o.clientX,y:o.clientY},w()}});window.addEventListener("mouseup",function(o){V=null});function j(o,e){const t=I.width,s=I.height;I.width=o,I.height=e;const n=I.width/t,i=I.height/s,r=Math.min(n,i),d=document.getElementById("resizeElements").checked;console.log("Resizing canvas",[d,n,i,r]);var c=l.getAllNodes();if(c.forEach(u=>{u.coordinates.x*=n,u.coordinates.y*=i,d&&(u.radius*=r,u.strokeWidth*=r)}),d){var h=l.getAllEdges();h.forEach(u=>{u.weight*=r}),l.zigzagLength*=r,l.zigzagSpacing*=r,l.zigzagEndLengths*=r}w({x:n,y:i})}function Ce(){l.clear(),g.clearSelection(),F("vertex"),w()}function _e(){f.addAction(new je)}function Te(){f.addAction(new Ke)}function Oe(){f.addAction(new Qe)}function w(o={x:1,y:1}){var e=Math.max(o.x,o.y);const t=document.getElementById("backgroundColor").value,s=document.getElementById("borderColor").value;X=[new ve({x:0,y:0},I.width,I.height,0,t,t)],X=X.concat(l.toDrawables()),X.push(new ve({x:0,y:0},I.width,I.height,20*e,t)),X.push(new ve({x:10*o.x,y:10*o.y},I.width-20*o.x,I.height-20*o.y,4*e,s)),Se&&!g.empty&&g.getItemsOfClass(y).forEach(n=>{X.push(new ze(n.coordinates,n.radius*1.2*e,2*e,null,"#ff0000"))}),Ze(),document.getElementById("graph-stats").textContent=`Nodes: ${l.getNrOfNodes()}, Edges: ${l.getNrOfEdges()}`}function fe(o,e){const t=document.getElementById(o);t instanceof HTMLInputElement&&(t.value=e)}function ht(){const o=document.getElementById("sideChainLength").valueAsNumber,e=document.getElementById("sideChainProb").valueAsNumber,t=document.getElementById("sideChainLengthRandomness").valueAsNumber,s=document.getElementById("sideChainAngleRandomness").valueAsNumber;g.getItemsOfClass(y).forEach(i=>{const r=l.getEdgesInvolvingNode(i.id);if(r.length!==2)return;const d=l.getNode(r[0].getOtherNodeId(i.id)),c=l.getNode(r[1].getOtherNodeId(i.id));if(!d||!c)return;const h=c.coordinates.x-d.coordinates.x,u=c.coordinates.y-d.coordinates.y,N=Math.sqrt(h*h+u*u),v=h/N,E=u/N,Z=-E,G=v,z=E,M=-v,_=Math.floor(e),q=e-_,B=_+(Math.random()<q?1:0);let k=Math.random()<.5;for(let T=0;T<B;T++){k=!k;const U=k?Z:z,de=k?G:M,ce=Math.PI*s,L=(Math.random()*2-1)*ce,Q=Math.cos(L),ee=Math.sin(L),H=U*Q-de*ee,O=U*ee+de*Q,le=i.coordinates.x+H*o*(1-t*Math.random()),he=i.coordinates.y+O*o*(1-t*Math.random()),te=oe++,ge=new y(te,new p(le,he),i.radius,i.strokeWidth,i.fillColor,i.strokeColor);f.addAction(new Me(te,new p(le,he))),f.addAction(new Ae(i,[ge]))}})}function Ie(){ae=new ct({canvas:I,recorderOptions:{fps:60,videoBitsPerSecond:5e6},animatorOptions:{targetFPS:60}})}function gt(){if(D){alert("Already recording edges!");return}D=!0,C=[],K(),console.log("Started recording edge additions")}function ut(){if(!D){alert("Not currently recording edges!");return}if(C.length===0){alert("No edges were recorded!"),D=!1,K();return}D=!1,K(),console.log(`Stopped recording. ${C.length} edges recorded.`)}async function mt(){if(C.length===0){alert('No edges recorded! Use "Start Recording Edges" first.');return}ae||Ie();const o=document.getElementById("edgeAnimationDuration").valueAsNumber,e=30;Y=[];const t=new Map;C.forEach(({type:i,fromNode:r,toNode:d,color:c,weight:h})=>{const u=r.id<d.id?`${r.id}-${d.id}`:`${d.id}-${r.id}`;t.set(u,{lastAction:i,fromNode:r,toNode:d,color:c,weight:h})}),t.forEach((i,r)=>{const c=l.getEdgesInvolvingNodes([i.fromNode.id,i.toNode.id]).find(h=>h.fromId===i.fromNode.id&&h.toId===i.toNode.id||h.fromId===i.toNode.id&&h.toId===i.fromNode.id);i.lastAction==="add"?c&&l.deleteEdge(c):c||l.addEdge(i.fromNode.id,i.toNode.id,i.color,i.weight)}),w();const s=[];C.forEach(({type:i,fromNode:r,toNode:d,color:c,weight:h},u)=>{const N=o/e,v=new me({x:r.coordinates.x,y:r.coordinates.y},{x:d.coordinates.x,y:d.coordinates.y},i==="add"?0:1,!0,c,h,l.zigzagSpacing,l.zigzagLength,l.zigzagEndLengths);for(let E=0;E<=e;E++){const Z=E/e;s.push({action:()=>{if(i==="add")E===0?Y[u]=v:E<e?v.setProgress(Z):(Y[u]=null,l.addEdge(r.id,d.id,c,h));else if(E===0){const z=l.getEdgesInvolvingNodes([r.id,d.id]).find(M=>M.fromId===r.id&&M.toId===d.id||M.fromId===d.id&&M.toId===r.id);z&&l.deleteEdge(z),Y[u]=v}else E<e?v.setProgress(1-Z):Y[u]=null;w()},duration:N})}});const n={name:"Edge Animation",frames:s,defaultFrameDuration:o/e,onComplete:()=>{Y=[]}};try{const i=C.filter(c=>c.type==="add").length,r=C.filter(c=>c.type==="remove").length,d=`Recording edge animation (${i} additions, ${r} removals)...`;W(d),await ae.recordMovie([n],"edge-animation.webm"),W("Movie saved successfully!"),setTimeout(()=>W(""),3e3)}catch(i){console.error("Error creating movie:",i),alert("Error creating movie: "+i),W("Error creating movie")}}async function ft(){ae||Ie();const o=document.getElementById("simulationType").value,e=document.getElementById("simulationStepCount").valueAsNumber,t=document.getElementById("simulationStepDuration").valueAsNumber;let s,n;if(o==="force_balance")s=Re,n="Force Balance";else if(o==="position_equilibration")s=Fe,n="Position Equilibration";else{alert("Invalid simulation type");return}const i=lt.createSimulationAnimation(s,()=>w(),{stepCount:e,stepDuration:t});try{W(`Recording ${n} simulation movie...`),await ae.recordMovie([i],`${o}-simulation.webm`),W("Movie saved successfully!"),setTimeout(()=>W(""),3e3)}catch(r){console.error("Error creating movie:",r),alert("Error creating movie: "+r),W("Error creating movie")}}function K(){const o=document.getElementById("startRecordingEdgesBtn"),e=document.getElementById("stopRecordingEdgesBtn"),t=document.getElementById("recordingIndicator");D?(o.disabled=!0,e.disabled=!1,t&&(t.textContent=`Recording... (${C.length} edges)`,t.style.color="red")):(o.disabled=!1,e.disabled=!0,t&&(t.textContent=C.length>0?`Ready (${C.length} edges recorded)`:"Not recording",t.style.color=C.length>0?"green":"black"))}function W(o){const e=document.getElementById("movieStatus");e&&(e.textContent=o,o?e.style.display="block":e.style.display="none")}window.addEventListener("load",()=>{J.style.width=m.canvasSize.x+"px",J.style.height=m.canvasSize.y+"px",fe("canvasWidth",m.canvasSize.x),fe("canvasHeight",m.canvasSize.y),j(m.canvasSize.x,m.canvasSize.y),Ce();var o=document.getElementById("modeSwitch");o.addEventListener("click",function(){F(o.value)}),document.getElementById("vertexRadius").addEventListener("change",function(){if(g.empty)return;const r=parseFloat(this.value);f.addAction(new ue(g.getItemsOfClass(y),r,"radius"))}),document.getElementById("vertexStrokeWidth").addEventListener("change",function(){if(g.empty)return;const r=parseFloat(this.value);f.addAction(new ue(g.getItemsOfClass(y),r,"strokeWidth"))}),document.getElementById("nodeFillColor").addEventListener("change",function(){g.empty||f.addAction(new ue(g.getItemsOfClass(y),this.value,"fillColor"))}),document.getElementById("nodeColor").addEventListener("change",function(){g.empty||f.addAction(new ue(g.getItemsOfClass(y),this.value,"strokeColor"))}),document.getElementById("selectVerticesStroke").addEventListener("change",function(){console.log("selectVerticesStroke",[this.value,l.getAllNodes().map(r=>r.strokeColor)]),f.addAction(new ie(l.getAllNodes().filter(r=>ne.deltaE00(ne.hex2lab(r.strokeColor),ne.hex2lab(this.value))<10),!0))}),document.getElementById("edgeColor").addEventListener("change",function(){l.getEdgesWithBothEndsInNodes(g.getItemsOfClass(y).map(r=>r.id)).forEach(r=>{r.color=this.value}),w()}),document.getElementById("lineWidth").addEventListener("change",function(){l.getEdgesWithBothEndsInNodes(g.getItemsOfClass(y).map(r=>r.id)).forEach(r=>{r.weight=parseFloat(this.value)}),w()}),document.getElementById("mergeConnectionColor").addEventListener("change",r=>{const d=r.target;ot(d.value),w()}),document.getElementById("canvasWidth").addEventListener("change",function(){const r=parseFloat(this.value);f.addAction(new class{constructor(){a(this,"targetValue",r);a(this,"previousValue",m.canvasSize.x)}setWidth(d){J.style.width=d+"px",m.canvasSize.x=d,j(m.canvasSize.x,m.canvasSize.y),w(),document.getElementById("canvas-size").textContent=`Canvas size: ${m.canvasSize.x}x${m.canvasSize.y}`}do(){this.setWidth(this.targetValue)}undo(){this.setWidth(this.previousValue)}})}),document.getElementById("canvasHeight").addEventListener("change",function(){const r=parseFloat(this.value);f.addAction(new class{constructor(){a(this,"targetValue",r);a(this,"previousValue",m.canvasSize.y)}setHeight(d){J.style.height=d+"px",m.canvasSize.y=d,j(m.canvasSize.x,m.canvasSize.y),w(),document.getElementById("canvas-size").textContent=`Canvas size: ${m.canvasSize.x}x${m.canvasSize.y}`}do(){this.setHeight(this.targetValue)}undo(){this.setHeight(this.previousValue)}})}),document.getElementById("disablePBC").addEventListener("change",function(){m.disablePBC=this.checked,w()}),document.getElementById("clearSelectionButton").addEventListener("click",Te),document.getElementById("invertSelectionButton").addEventListener("click",Oe),document.getElementById("selectAllButton").addEventListener("click",_e),document.getElementById("clearCanvasButton").addEventListener("click",Ce),document.getElementById("removeDuplicateEdges").addEventListener("click",()=>{l.removeDuplicateEdges(),w()}),document.getElementById("removeSelfEdges").addEventListener("click",()=>{l.cleanupEdges(),w()}),document.getElementById("saveImageButton").addEventListener("click",We),document.getElementById("forceBalanceStep").addEventListener("click",()=>{const r=document.getElementById("nForceBalanceSteps").valueAsNumber;for(let d=0;d<r;d++)console.log("Running force balance step "+d+" of "+r),Re(),w()}),document.getElementById("positionEquilibrationStep").addEventListener("click",()=>{const r=document.getElementById("nPositionEquilibrationSteps").valueAsNumber;for(let d=0;d<r;d++)console.log("Running position equilibration step "+d+" of "+r),Fe(),w()}),document.getElementById("sideChainGenerationButton").addEventListener("click",()=>{ht()}),document.getElementById("bifunctionalRemoval").addEventListener("click",()=>{rt(),w()}),document.getElementById("exportGraphButton").addEventListener("click",De),document.getElementById("saveSvgButton").addEventListener("click",()=>{pt()}),document.getElementById("import").addEventListener("change",yt);const e=document.getElementsByClassName("redraw-onchange");Array.from(e).forEach(r=>{r instanceof HTMLInputElement&&r.addEventListener("change",()=>{w()})}),Ie();const t=document.getElementById("startRecordingEdgesBtn");t&&t.addEventListener("click",gt);const s=document.getElementById("stopRecordingEdgesBtn");s&&s.addEventListener("click",ut);const n=document.getElementById("createEdgeMovieBtn");n&&n.addEventListener("click",mt);const i=document.getElementById("createSimMovieBtn");i&&i.addEventListener("click",ft),K()});function F(o){f.addAction(new class{constructor(){a(this,"previousInteractionMode",R);a(this,"targetInteractionMode",o)}resetInteractionMode(e){console.log("Resetting interaction mode to: "+e),R=e,document.getElementById("modeSwitch").value=e}do(){this.resetInteractionMode(this.targetInteractionMode)}undo(){this.resetInteractionMode(this.previousInteractionMode)}})}function We(){const o=document.getElementById("resizeElements"),e=o.checked;o.checked=!0,Se=!1,m.isScaled=!0;const t={x:m.canvasSize.x,y:m.canvasSize.y};m.canvasSize.x*=m.imageScaleFactor,m.canvasSize.y*=m.imageScaleFactor,j(m.canvasSize.x,m.canvasSize.y);const n=document.getElementById("canvas").toDataURL("image/png"),i=document.createElement("a");i.href=n,i.download="polymer-graph-sketch.png",i.click(),Se=!0,m.isScaled=!1,m.canvasSize.x=t.x,m.canvasSize.y=t.y,j(m.canvasSize.x,m.canvasSize.y),w(),o.checked=e}function pt(){const o=$;$=new st(m.canvasSize.x,m.canvasSize.y),Ze();const e=$.getSVG();$=o;const t=new XMLSerializer().serializeToString(e),s=document.createElement("a");s.href="data:image/svg+xml;base64,"+btoa(t),s.download="graph.svg",s.click()}function De(){var o=new Blob([JSON.stringify({graph:l,settings:m})],{type:"application/json"}),e=URL.createObjectURL(o),t=document.createElement("a");t.href=e,t.download="graph.json",t.click()}function yt(){var s;const e=(s=document.getElementById("import").files)==null?void 0:s[0];if(!e)return;const t=new FileReader;t.onload=function(n){var i;if((i=n.target)!=null&&i.result){const r=JSON.parse(n.target.result);"settings"in r?(m=x.fromJSON(r.settings),J.style.width=m.canvasSize.x+"px",J.style.height=m.canvasSize.y+"px",fe("canvasWidth",m.canvasSize.x),fe("canvasHeight",m.canvasSize.y),j(m.canvasSize.x,m.canvasSize.y),l.fromJSON(r.graph)):l.fromJSON(r),oe=Math.max(...l.getAllNodeIds().filter(d=>!isNaN(d)))+1,w()}},t.readAsText(e)}document.addEventListener("keydown",function(o){o.ctrlKey||o.metaKey?o.key==="s"?(We(),De()):o.key==="z"?o.shiftKey?f.redo():f.undo():o.key==="y"&&f.redo():o.key==="a"?_e():o.key==="c"||o.key=="Escape"?Te():o.key=="i"?Oe():o.key==="d"?F("delete_vertex"):o.key==="r"?F("random_walk"):o.key==="l"?F("delete_edge"):o.key==="s"?F("select"):o.key==="h"?F("select_chains"):o.key==="v"?F("vertex"):o.key==="e"?F("edge"):o.key==="Backspace"||o.key==="Delete"?f.addAction(new ke(g.getItemsOfClass(y))):console.log("Unhandled keyboard shortcut: "+o.key)});
